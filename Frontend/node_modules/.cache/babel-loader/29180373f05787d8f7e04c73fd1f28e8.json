{"ast":null,"code":"'use strict'; // eslint-disable-next-line import/order\n\nvar config = require(\"../config\");\n\nvar https = /^http:/.test(config().upload_prefix) ? require('http') : require('https');\n\nvar querystring = require(\"querystring\");\n\nvar Q = require('q');\n\nvar url = require('url');\n\nvar utils = require(\"../utils\");\n\nvar ensureOption = require('../utils/ensureOption').defaults(config());\n\nvar extend = utils.extend,\n    includes = utils.includes;\n\nfunction execute_request(method, params, auth, api_url, callback) {\n  var options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};\n  method = method.toUpperCase();\n  var deferred = Q.defer();\n  var query_params = void 0,\n      handle_response = void 0; // declare to user later\n\n  var key = auth.key;\n  var secret = auth.secret;\n  var content_type = 'application/x-www-form-urlencoded';\n\n  if (options.content_type === 'json') {\n    query_params = JSON.stringify(params);\n    content_type = 'application/json';\n  } else {\n    query_params = querystring.stringify(params);\n  }\n\n  if (method === \"GET\") {\n    api_url += \"?\" + query_params;\n  }\n\n  var request_options = url.parse(api_url);\n  request_options = extend(request_options, {\n    method: method,\n    headers: {\n      'Content-Type': content_type,\n      'User-Agent': utils.getUserAgent()\n    },\n    auth: key + \":\" + secret\n  });\n\n  if (options.agent != null) {\n    request_options.agent = options.agent;\n  }\n\n  if (method !== \"GET\") {\n    request_options.headers['Content-Length'] = Buffer.byteLength(query_params);\n  }\n\n  handle_response = function handle_response(res) {\n    if (includes([200, 400, 401, 403, 404, 409, 420, 500], res.statusCode)) {\n      var buffer = \"\";\n      var error = false;\n      res.on(\"data\", function (d) {\n        buffer += d;\n        return buffer;\n      });\n      res.on(\"end\", function () {\n        var result = void 0;\n\n        if (error) {\n          return;\n        }\n\n        try {\n          result = JSON.parse(buffer);\n        } catch (e) {\n          result = {\n            error: {\n              message: \"Server return invalid JSON response. Status Code \" + res.statusCode\n            }\n          };\n        }\n\n        if (result.error) {\n          result.error.http_code = res.statusCode;\n        } else {\n          result.rate_limit_allowed = parseInt(res.headers[\"x-featureratelimit-limit\"]);\n          result.rate_limit_reset_at = new Date(res.headers[\"x-featureratelimit-reset\"]);\n          result.rate_limit_remaining = parseInt(res.headers[\"x-featureratelimit-remaining\"]);\n        }\n\n        if (result.error) {\n          deferred.reject(Object.assign({\n            request_options,\n            query_params\n          }, result));\n        } else {\n          deferred.resolve(result);\n        }\n\n        if (typeof callback === \"function\") {\n          callback(result);\n        }\n      });\n      res.on(\"error\", function (e) {\n        error = true;\n        var err_obj = {\n          error: {\n            message: e,\n            http_code: res.statusCode,\n            request_options,\n            query_params\n          }\n        };\n        deferred.reject(err_obj.error);\n\n        if (typeof callback === \"function\") {\n          callback(err_obj);\n        }\n      });\n    } else {\n      var err_obj = {\n        error: {\n          message: \"Server returned unexpected status code - \" + res.statusCode,\n          http_code: res.statusCode,\n          request_options,\n          query_params\n        }\n      };\n      deferred.reject(err_obj.error);\n\n      if (typeof callback === \"function\") {\n        callback(err_obj);\n      }\n    }\n  };\n\n  var request = https.request(request_options, handle_response);\n  request.on(\"error\", function (e) {\n    deferred.reject(e);\n    return typeof callback === \"function\" ? callback({\n      error: e\n    }) : void 0;\n  });\n  request.setTimeout(ensureOption(options, \"timeout\", 60000));\n\n  if (method !== \"GET\") {\n    request.write(query_params);\n  }\n\n  request.end();\n  return deferred.promise;\n}\n\nmodule.exports = execute_request;","map":{"version":3,"sources":["D:/PROJECT ALL/MonkeyFruad/Backend/node_modules/cloudinary/lib-es5/api_client/execute_request.js"],"names":["config","require","https","test","upload_prefix","querystring","Q","url","utils","ensureOption","defaults","extend","includes","execute_request","method","params","auth","api_url","callback","options","arguments","length","undefined","toUpperCase","deferred","defer","query_params","handle_response","key","secret","content_type","JSON","stringify","request_options","parse","headers","getUserAgent","agent","Buffer","byteLength","res","statusCode","buffer","error","on","d","result","e","message","http_code","rate_limit_allowed","parseInt","rate_limit_reset_at","Date","rate_limit_remaining","reject","Object","assign","resolve","err_obj","request","setTimeout","write","end","promise","module","exports"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\n// eslint-disable-next-line import/order\r\nvar config = require(\"../config\");\r\nvar https = /^http:/.test(config().upload_prefix) ? require('http') : require('https');\r\nvar querystring = require(\"querystring\");\r\nvar Q = require('q');\r\nvar url = require('url');\r\nvar utils = require(\"../utils\");\r\nvar ensureOption = require('../utils/ensureOption').defaults(config());\r\n\r\nvar extend = utils.extend,\r\n    includes = utils.includes;\r\n\r\n\r\nfunction execute_request(method, params, auth, api_url, callback) {\r\n  var options = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : {};\r\n\r\n  method = method.toUpperCase();\r\n  var deferred = Q.defer();\r\n\r\n  var query_params = void 0,\r\n      handle_response = void 0; // declare to user later\r\n  var key = auth.key;\r\n  var secret = auth.secret;\r\n  var content_type = 'application/x-www-form-urlencoded';\r\n\r\n  if (options.content_type === 'json') {\r\n    query_params = JSON.stringify(params);\r\n    content_type = 'application/json';\r\n  } else {\r\n    query_params = querystring.stringify(params);\r\n  }\r\n\r\n  if (method === \"GET\") {\r\n    api_url += \"?\" + query_params;\r\n  }\r\n\r\n  var request_options = url.parse(api_url);\r\n\r\n  request_options = extend(request_options, {\r\n    method: method,\r\n    headers: {\r\n      'Content-Type': content_type,\r\n      'User-Agent': utils.getUserAgent()\r\n    },\r\n    auth: key + \":\" + secret\r\n  });\r\n  if (options.agent != null) {\r\n    request_options.agent = options.agent;\r\n  }\r\n  if (method !== \"GET\") {\r\n    request_options.headers['Content-Length'] = Buffer.byteLength(query_params);\r\n  }\r\n  handle_response = function handle_response(res) {\r\n    if (includes([200, 400, 401, 403, 404, 409, 420, 500], res.statusCode)) {\r\n      var buffer = \"\";\r\n      var error = false;\r\n      res.on(\"data\", function (d) {\r\n        buffer += d;\r\n        return buffer;\r\n      });\r\n      res.on(\"end\", function () {\r\n        var result = void 0;\r\n        if (error) {\r\n          return;\r\n        }\r\n        try {\r\n          result = JSON.parse(buffer);\r\n        } catch (e) {\r\n          result = {\r\n            error: {\r\n              message: \"Server return invalid JSON response. Status Code \" + res.statusCode\r\n            }\r\n          };\r\n        }\r\n\r\n        if (result.error) {\r\n          result.error.http_code = res.statusCode;\r\n        } else {\r\n          result.rate_limit_allowed = parseInt(res.headers[\"x-featureratelimit-limit\"]);\r\n          result.rate_limit_reset_at = new Date(res.headers[\"x-featureratelimit-reset\"]);\r\n          result.rate_limit_remaining = parseInt(res.headers[\"x-featureratelimit-remaining\"]);\r\n        }\r\n\r\n        if (result.error) {\r\n          deferred.reject(Object.assign({\r\n            request_options,\r\n            query_params\r\n          }, result));\r\n        } else {\r\n          deferred.resolve(result);\r\n        }\r\n        if (typeof callback === \"function\") {\r\n          callback(result);\r\n        }\r\n      });\r\n      res.on(\"error\", function (e) {\r\n        error = true;\r\n        var err_obj = {\r\n          error: {\r\n            message: e,\r\n            http_code: res.statusCode,\r\n            request_options,\r\n            query_params\r\n          }\r\n        };\r\n        deferred.reject(err_obj.error);\r\n        if (typeof callback === \"function\") {\r\n          callback(err_obj);\r\n        }\r\n      });\r\n    } else {\r\n      var err_obj = {\r\n        error: {\r\n          message: \"Server returned unexpected status code - \" + res.statusCode,\r\n          http_code: res.statusCode,\r\n          request_options,\r\n          query_params\r\n        }\r\n      };\r\n      deferred.reject(err_obj.error);\r\n      if (typeof callback === \"function\") {\r\n        callback(err_obj);\r\n      }\r\n    }\r\n  };\r\n\r\n  var request = https.request(request_options, handle_response);\r\n  request.on(\"error\", function (e) {\r\n    deferred.reject(e);\r\n    return typeof callback === \"function\" ? callback({ error: e }) : void 0;\r\n  });\r\n  request.setTimeout(ensureOption(options, \"timeout\", 60000));\r\n  if (method !== \"GET\") {\r\n    request.write(query_params);\r\n  }\r\n  request.end();\r\n  return deferred.promise;\r\n}\r\n\r\nmodule.exports = execute_request;"]},"metadata":{},"sourceType":"script"}