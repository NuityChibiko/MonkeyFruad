{"ast":null,"code":"/*! firebase-admin v9.4.2 */\n\"use strict\";\n/*!\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SecurityRules = exports.Ruleset = void 0;\n\nvar validator = require(\"../utils/validator\");\n\nvar security_rules_api_client_internal_1 = require(\"./security-rules-api-client-internal\");\n\nvar security_rules_internal_1 = require(\"./security-rules-internal\");\n\nvar RulesetMetadataListImpl =\n/** @class */\nfunction () {\n  function RulesetMetadataListImpl(response) {\n    if (!validator.isNonNullObject(response) || !validator.isArray(response.rulesets)) {\n      throw new security_rules_internal_1.FirebaseSecurityRulesError('invalid-argument', \"Invalid ListRulesets response: \" + JSON.stringify(response));\n    }\n\n    this.rulesets = response.rulesets.map(function (rs) {\n      return {\n        name: stripProjectIdPrefix(rs.name),\n        createTime: new Date(rs.createTime).toUTCString()\n      };\n    });\n\n    if (response.nextPageToken) {\n      this.nextPageToken = response.nextPageToken;\n    }\n  }\n\n  return RulesetMetadataListImpl;\n}();\n/**\r\n * Represents a set of Firebase security rules.\r\n */\n\n\nvar Ruleset =\n/** @class */\nfunction () {\n  function Ruleset(ruleset) {\n    if (!validator.isNonNullObject(ruleset) || !validator.isNonEmptyString(ruleset.name) || !validator.isNonEmptyString(ruleset.createTime) || !validator.isNonNullObject(ruleset.source)) {\n      throw new security_rules_internal_1.FirebaseSecurityRulesError('invalid-argument', \"Invalid Ruleset response: \" + JSON.stringify(ruleset));\n    }\n\n    this.name = stripProjectIdPrefix(ruleset.name);\n    this.createTime = new Date(ruleset.createTime).toUTCString();\n    this.source = ruleset.source.files || [];\n  }\n\n  return Ruleset;\n}();\n\nexports.Ruleset = Ruleset;\n/**\r\n * The Firebase `SecurityRules` service interface.\r\n *\r\n * Do not call this constructor directly. Instead, use\r\n * [`admin.securityRules()`](securityRules#securityRules).\r\n */\n\nvar SecurityRules =\n/** @class */\nfunction () {\n  /**\r\n   * @param {object} app The app for this SecurityRules service.\r\n   * @constructor\r\n   */\n  function SecurityRules(app) {\n    this.app = app;\n    this.INTERNAL = new SecurityRulesInternals();\n    this.client = new security_rules_api_client_internal_1.SecurityRulesApiClient(app);\n  }\n  /**\r\n   * Gets the Ruleset identified by the given name. The input name should be the short name string without\r\n   * the project ID prefix. For example, to retrieve the `projects/project-id/rulesets/my-ruleset`, pass the\r\n   * short name \"my-ruleset\". Rejects with a `not-found` error if the specified Ruleset cannot be found.\r\n   *\r\n   * @param {string} name Name of the Ruleset to retrieve.\r\n   * @returns {Promise<Ruleset>} A promise that fulfills with the specified Ruleset.\r\n   */\n\n\n  SecurityRules.prototype.getRuleset = function (name) {\n    return this.client.getRuleset(name).then(function (rulesetResponse) {\n      return new Ruleset(rulesetResponse);\n    });\n  };\n  /**\r\n   * Gets the Ruleset currently applied to Cloud Firestore. Rejects with a `not-found` error if no Ruleset is\r\n   * applied on Firestore.\r\n   *\r\n   * @returns {Promise<Ruleset>} A promise that fulfills with the Firestore Ruleset.\r\n   */\n\n\n  SecurityRules.prototype.getFirestoreRuleset = function () {\n    return this.getRulesetForRelease(SecurityRules.CLOUD_FIRESTORE);\n  };\n  /**\r\n   * Creates a new ruleset from the given source, and applies it to Cloud Firestore.\r\n   *\r\n   * @param {string|Buffer} source Rules source to apply.\r\n   * @returns {Promise<Ruleset>} A promise that fulfills when the ruleset is created and released.\r\n   */\n\n\n  SecurityRules.prototype.releaseFirestoreRulesetFromSource = function (source) {\n    var _this = this;\n\n    return Promise.resolve().then(function () {\n      var rulesFile = _this.createRulesFileFromSource('firestore.rules', source);\n\n      return _this.createRuleset(rulesFile);\n    }).then(function (ruleset) {\n      return _this.releaseFirestoreRuleset(ruleset).then(function () {\n        return ruleset;\n      });\n    });\n  };\n  /**\r\n   * Makes the specified ruleset the currently applied ruleset for Cloud Firestore.\r\n   *\r\n   * @param {string|RulesetMetadata} ruleset Name of the ruleset to apply or a RulesetMetadata object containing\r\n   *   the name.\r\n   * @returns {Promise<void>} A promise that fulfills when the ruleset is released.\r\n   */\n\n\n  SecurityRules.prototype.releaseFirestoreRuleset = function (ruleset) {\n    return this.releaseRuleset(ruleset, SecurityRules.CLOUD_FIRESTORE);\n  };\n  /**\r\n   * Gets the Ruleset currently applied to a Cloud Storage bucket. Rejects with a `not-found` error if no Ruleset is\r\n   * applied on the bucket.\r\n   *\r\n   * @param {string=} bucket Optional name of the Cloud Storage bucket to be retrieved. If not specified,\r\n   *   retrieves the ruleset applied on the default bucket configured via `AppOptions`.\r\n   * @returns {Promise<Ruleset>} A promise that fulfills with the Cloud Storage Ruleset.\r\n   */\n\n\n  SecurityRules.prototype.getStorageRuleset = function (bucket) {\n    var _this = this;\n\n    return Promise.resolve().then(function () {\n      return _this.getBucketName(bucket);\n    }).then(function (bucketName) {\n      return _this.getRulesetForRelease(SecurityRules.FIREBASE_STORAGE + \"/\" + bucketName);\n    });\n  };\n  /**\r\n   * Creates a new ruleset from the given source, and applies it to a Cloud Storage bucket.\r\n   *\r\n   * @param {string|Buffer} source Rules source to apply.\r\n   * @param {string=} bucket Optional name of the Cloud Storage bucket to apply the rules on. If not specified,\r\n   *   applies the ruleset on the default bucket configured via `AppOptions`.\r\n   * @returns {Promise<Ruleset>} A promise that fulfills when the ruleset is created and released.\r\n   */\n\n\n  SecurityRules.prototype.releaseStorageRulesetFromSource = function (source, bucket) {\n    var _this = this;\n\n    return Promise.resolve().then(function () {\n      // Bucket name is not required until the last step. But since there's a createRuleset step\n      // before then, make sure to run this check and fail early if the bucket name is invalid.\n      _this.getBucketName(bucket);\n\n      var rulesFile = _this.createRulesFileFromSource('storage.rules', source);\n\n      return _this.createRuleset(rulesFile);\n    }).then(function (ruleset) {\n      return _this.releaseStorageRuleset(ruleset, bucket).then(function () {\n        return ruleset;\n      });\n    });\n  };\n  /**\r\n   * Makes the specified ruleset the currently applied ruleset for a Cloud Storage bucket.\r\n   *\r\n   * @param {string|RulesetMetadata} ruleset Name of the ruleset to apply or a RulesetMetadata object containing\r\n   *   the name.\r\n   * @param {string=} bucket Optional name of the Cloud Storage bucket to apply the rules on. If not specified,\r\n   *   applies the ruleset on the default bucket configured via `AppOptions`.\r\n   * @returns {Promise<void>} A promise that fulfills when the ruleset is released.\r\n   */\n\n\n  SecurityRules.prototype.releaseStorageRuleset = function (ruleset, bucket) {\n    var _this = this;\n\n    return Promise.resolve().then(function () {\n      return _this.getBucketName(bucket);\n    }).then(function (bucketName) {\n      return _this.releaseRuleset(ruleset, SecurityRules.FIREBASE_STORAGE + \"/\" + bucketName);\n    });\n  };\n  /**\r\n   * Creates a {@link securityRules.RulesFile `RuleFile`} with the given name\r\n   * and source. Throws an error if any of the arguments are invalid. This is a local\r\n   * operation, and does not involve any network API calls.\r\n   *\r\n   * @example\r\n   * ```javascript\r\n   * const source = '// Some rules source';\r\n   * const rulesFile = admin.securityRules().createRulesFileFromSource(\r\n   *   'firestore.rules', source);\r\n   * ```\r\n   *\r\n   * @param name Name to assign to the rules file. This is usually a short file name that\r\n   *   helps identify the file in a ruleset.\r\n   * @param source Contents of the rules file.\r\n   * @return A new rules file instance.\r\n   */\n\n\n  SecurityRules.prototype.createRulesFileFromSource = function (name, source) {\n    if (!validator.isNonEmptyString(name)) {\n      throw new security_rules_internal_1.FirebaseSecurityRulesError('invalid-argument', 'Name must be a non-empty string.');\n    }\n\n    var content;\n\n    if (validator.isNonEmptyString(source)) {\n      content = source;\n    } else if (validator.isBuffer(source)) {\n      content = source.toString('utf-8');\n    } else {\n      throw new security_rules_internal_1.FirebaseSecurityRulesError('invalid-argument', 'Source must be a non-empty string or a Buffer.');\n    }\n\n    return {\n      name: name,\n      content: content\n    };\n  };\n  /**\r\n   * Creates a new {@link securityRules.Ruleset `Ruleset`} from the given\r\n   * {@link securityRules.RulesFile `RuleFile`}.\r\n   *\r\n   * @param file Rules file to include in the new `Ruleset`.\r\n   * @returns A promise that fulfills with the newly created `Ruleset`.\r\n   */\n\n\n  SecurityRules.prototype.createRuleset = function (file) {\n    var ruleset = {\n      source: {\n        files: [file]\n      }\n    };\n    return this.client.createRuleset(ruleset).then(function (rulesetResponse) {\n      return new Ruleset(rulesetResponse);\n    });\n  };\n  /**\r\n   * Deletes the {@link securityRules.Ruleset `Ruleset`} identified by the given\r\n   * name. The input name should be the short name string without the project ID\r\n   * prefix. For example, to delete the `projects/project-id/rulesets/my-ruleset`,\r\n   * pass the  short name \"my-ruleset\". Rejects with a `not-found` error if the\r\n   * specified `Ruleset` cannot be found.\r\n   *\r\n   * @param name Name of the `Ruleset` to delete.\r\n   * @return A promise that fulfills when the `Ruleset` is deleted.\r\n   */\n\n\n  SecurityRules.prototype.deleteRuleset = function (name) {\n    return this.client.deleteRuleset(name);\n  };\n  /**\r\n   * Retrieves a page of ruleset metadata.\r\n   *\r\n   * @param pageSize The page size, 100 if undefined. This is also the maximum allowed\r\n   *   limit.\r\n   * @param nextPageToken The next page token. If not specified, returns rulesets\r\n   *   starting without any offset.\r\n   * @return A promise that fulfills with a page of rulesets.\r\n   */\n\n\n  SecurityRules.prototype.listRulesetMetadata = function (pageSize, nextPageToken) {\n    if (pageSize === void 0) {\n      pageSize = 100;\n    }\n\n    return this.client.listRulesets(pageSize, nextPageToken).then(function (response) {\n      return new RulesetMetadataListImpl(response);\n    });\n  };\n\n  SecurityRules.prototype.getRulesetForRelease = function (releaseName) {\n    var _this = this;\n\n    return this.client.getRelease(releaseName).then(function (release) {\n      var rulesetName = release.rulesetName;\n\n      if (!validator.isNonEmptyString(rulesetName)) {\n        throw new security_rules_internal_1.FirebaseSecurityRulesError('not-found', \"Ruleset name not found for \" + releaseName + \".\");\n      }\n\n      return _this.getRuleset(stripProjectIdPrefix(rulesetName));\n    });\n  };\n\n  SecurityRules.prototype.releaseRuleset = function (ruleset, releaseName) {\n    if (!validator.isNonEmptyString(ruleset) && (!validator.isNonNullObject(ruleset) || !validator.isNonEmptyString(ruleset.name))) {\n      var err = new security_rules_internal_1.FirebaseSecurityRulesError('invalid-argument', 'ruleset must be a non-empty name or a RulesetMetadata object.');\n      return Promise.reject(err);\n    }\n\n    var rulesetName = validator.isString(ruleset) ? ruleset : ruleset.name;\n    return this.client.updateRelease(releaseName, rulesetName).then(function () {\n      return;\n    });\n  };\n\n  SecurityRules.prototype.getBucketName = function (bucket) {\n    var bucketName = typeof bucket !== 'undefined' ? bucket : this.app.options.storageBucket;\n\n    if (!validator.isNonEmptyString(bucketName)) {\n      throw new security_rules_internal_1.FirebaseSecurityRulesError('invalid-argument', 'Bucket name not specified or invalid. Specify a default bucket name via the ' + 'storageBucket option when initializing the app, or specify the bucket name ' + 'explicitly when calling the rules API.');\n    }\n\n    return bucketName;\n  };\n\n  SecurityRules.CLOUD_FIRESTORE = 'cloud.firestore';\n  SecurityRules.FIREBASE_STORAGE = 'firebase.storage';\n  return SecurityRules;\n}();\n\nexports.SecurityRules = SecurityRules;\n\nvar SecurityRulesInternals =\n/** @class */\nfunction () {\n  function SecurityRulesInternals() {}\n\n  SecurityRulesInternals.prototype.delete = function () {\n    return Promise.resolve();\n  };\n\n  return SecurityRulesInternals;\n}();\n\nfunction stripProjectIdPrefix(name) {\n  return name.split('/').pop();\n}","map":{"version":3,"sources":["D:/PROJECT ALL/MonkeyFruad/Backend/node_modules/firebase-admin/lib/security-rules/security-rules.js"],"names":["Object","defineProperty","exports","value","SecurityRules","Ruleset","validator","require","security_rules_api_client_internal_1","security_rules_internal_1","RulesetMetadataListImpl","response","isNonNullObject","isArray","rulesets","FirebaseSecurityRulesError","JSON","stringify","map","rs","name","stripProjectIdPrefix","createTime","Date","toUTCString","nextPageToken","ruleset","isNonEmptyString","source","files","app","INTERNAL","SecurityRulesInternals","client","SecurityRulesApiClient","prototype","getRuleset","then","rulesetResponse","getFirestoreRuleset","getRulesetForRelease","CLOUD_FIRESTORE","releaseFirestoreRulesetFromSource","_this","Promise","resolve","rulesFile","createRulesFileFromSource","createRuleset","releaseFirestoreRuleset","releaseRuleset","getStorageRuleset","bucket","getBucketName","bucketName","FIREBASE_STORAGE","releaseStorageRulesetFromSource","releaseStorageRuleset","content","isBuffer","toString","file","deleteRuleset","listRulesetMetadata","pageSize","listRulesets","releaseName","getRelease","release","rulesetName","err","reject","isString","updateRelease","options","storageBucket","delete","split","pop"],"mappings":"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","sourcesContent":["/*! firebase-admin v9.4.2 */\r\n\"use strict\";\r\n/*!\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.SecurityRules = exports.Ruleset = void 0;\r\nvar validator = require(\"../utils/validator\");\r\nvar security_rules_api_client_internal_1 = require(\"./security-rules-api-client-internal\");\r\nvar security_rules_internal_1 = require(\"./security-rules-internal\");\r\nvar RulesetMetadataListImpl = /** @class */ (function () {\r\n    function RulesetMetadataListImpl(response) {\r\n        if (!validator.isNonNullObject(response) || !validator.isArray(response.rulesets)) {\r\n            throw new security_rules_internal_1.FirebaseSecurityRulesError('invalid-argument', \"Invalid ListRulesets response: \" + JSON.stringify(response));\r\n        }\r\n        this.rulesets = response.rulesets.map(function (rs) {\r\n            return {\r\n                name: stripProjectIdPrefix(rs.name),\r\n                createTime: new Date(rs.createTime).toUTCString(),\r\n            };\r\n        });\r\n        if (response.nextPageToken) {\r\n            this.nextPageToken = response.nextPageToken;\r\n        }\r\n    }\r\n    return RulesetMetadataListImpl;\r\n}());\r\n/**\r\n * Represents a set of Firebase security rules.\r\n */\r\nvar Ruleset = /** @class */ (function () {\r\n    function Ruleset(ruleset) {\r\n        if (!validator.isNonNullObject(ruleset) ||\r\n            !validator.isNonEmptyString(ruleset.name) ||\r\n            !validator.isNonEmptyString(ruleset.createTime) ||\r\n            !validator.isNonNullObject(ruleset.source)) {\r\n            throw new security_rules_internal_1.FirebaseSecurityRulesError('invalid-argument', \"Invalid Ruleset response: \" + JSON.stringify(ruleset));\r\n        }\r\n        this.name = stripProjectIdPrefix(ruleset.name);\r\n        this.createTime = new Date(ruleset.createTime).toUTCString();\r\n        this.source = ruleset.source.files || [];\r\n    }\r\n    return Ruleset;\r\n}());\r\nexports.Ruleset = Ruleset;\r\n/**\r\n * The Firebase `SecurityRules` service interface.\r\n *\r\n * Do not call this constructor directly. Instead, use\r\n * [`admin.securityRules()`](securityRules#securityRules).\r\n */\r\nvar SecurityRules = /** @class */ (function () {\r\n    /**\r\n     * @param {object} app The app for this SecurityRules service.\r\n     * @constructor\r\n     */\r\n    function SecurityRules(app) {\r\n        this.app = app;\r\n        this.INTERNAL = new SecurityRulesInternals();\r\n        this.client = new security_rules_api_client_internal_1.SecurityRulesApiClient(app);\r\n    }\r\n    /**\r\n     * Gets the Ruleset identified by the given name. The input name should be the short name string without\r\n     * the project ID prefix. For example, to retrieve the `projects/project-id/rulesets/my-ruleset`, pass the\r\n     * short name \"my-ruleset\". Rejects with a `not-found` error if the specified Ruleset cannot be found.\r\n     *\r\n     * @param {string} name Name of the Ruleset to retrieve.\r\n     * @returns {Promise<Ruleset>} A promise that fulfills with the specified Ruleset.\r\n     */\r\n    SecurityRules.prototype.getRuleset = function (name) {\r\n        return this.client.getRuleset(name)\r\n            .then(function (rulesetResponse) {\r\n            return new Ruleset(rulesetResponse);\r\n        });\r\n    };\r\n    /**\r\n     * Gets the Ruleset currently applied to Cloud Firestore. Rejects with a `not-found` error if no Ruleset is\r\n     * applied on Firestore.\r\n     *\r\n     * @returns {Promise<Ruleset>} A promise that fulfills with the Firestore Ruleset.\r\n     */\r\n    SecurityRules.prototype.getFirestoreRuleset = function () {\r\n        return this.getRulesetForRelease(SecurityRules.CLOUD_FIRESTORE);\r\n    };\r\n    /**\r\n     * Creates a new ruleset from the given source, and applies it to Cloud Firestore.\r\n     *\r\n     * @param {string|Buffer} source Rules source to apply.\r\n     * @returns {Promise<Ruleset>} A promise that fulfills when the ruleset is created and released.\r\n     */\r\n    SecurityRules.prototype.releaseFirestoreRulesetFromSource = function (source) {\r\n        var _this = this;\r\n        return Promise.resolve()\r\n            .then(function () {\r\n            var rulesFile = _this.createRulesFileFromSource('firestore.rules', source);\r\n            return _this.createRuleset(rulesFile);\r\n        })\r\n            .then(function (ruleset) {\r\n            return _this.releaseFirestoreRuleset(ruleset)\r\n                .then(function () {\r\n                return ruleset;\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Makes the specified ruleset the currently applied ruleset for Cloud Firestore.\r\n     *\r\n     * @param {string|RulesetMetadata} ruleset Name of the ruleset to apply or a RulesetMetadata object containing\r\n     *   the name.\r\n     * @returns {Promise<void>} A promise that fulfills when the ruleset is released.\r\n     */\r\n    SecurityRules.prototype.releaseFirestoreRuleset = function (ruleset) {\r\n        return this.releaseRuleset(ruleset, SecurityRules.CLOUD_FIRESTORE);\r\n    };\r\n    /**\r\n     * Gets the Ruleset currently applied to a Cloud Storage bucket. Rejects with a `not-found` error if no Ruleset is\r\n     * applied on the bucket.\r\n     *\r\n     * @param {string=} bucket Optional name of the Cloud Storage bucket to be retrieved. If not specified,\r\n     *   retrieves the ruleset applied on the default bucket configured via `AppOptions`.\r\n     * @returns {Promise<Ruleset>} A promise that fulfills with the Cloud Storage Ruleset.\r\n     */\r\n    SecurityRules.prototype.getStorageRuleset = function (bucket) {\r\n        var _this = this;\r\n        return Promise.resolve()\r\n            .then(function () {\r\n            return _this.getBucketName(bucket);\r\n        })\r\n            .then(function (bucketName) {\r\n            return _this.getRulesetForRelease(SecurityRules.FIREBASE_STORAGE + \"/\" + bucketName);\r\n        });\r\n    };\r\n    /**\r\n     * Creates a new ruleset from the given source, and applies it to a Cloud Storage bucket.\r\n     *\r\n     * @param {string|Buffer} source Rules source to apply.\r\n     * @param {string=} bucket Optional name of the Cloud Storage bucket to apply the rules on. If not specified,\r\n     *   applies the ruleset on the default bucket configured via `AppOptions`.\r\n     * @returns {Promise<Ruleset>} A promise that fulfills when the ruleset is created and released.\r\n     */\r\n    SecurityRules.prototype.releaseStorageRulesetFromSource = function (source, bucket) {\r\n        var _this = this;\r\n        return Promise.resolve()\r\n            .then(function () {\r\n            // Bucket name is not required until the last step. But since there's a createRuleset step\r\n            // before then, make sure to run this check and fail early if the bucket name is invalid.\r\n            _this.getBucketName(bucket);\r\n            var rulesFile = _this.createRulesFileFromSource('storage.rules', source);\r\n            return _this.createRuleset(rulesFile);\r\n        })\r\n            .then(function (ruleset) {\r\n            return _this.releaseStorageRuleset(ruleset, bucket)\r\n                .then(function () {\r\n                return ruleset;\r\n            });\r\n        });\r\n    };\r\n    /**\r\n     * Makes the specified ruleset the currently applied ruleset for a Cloud Storage bucket.\r\n     *\r\n     * @param {string|RulesetMetadata} ruleset Name of the ruleset to apply or a RulesetMetadata object containing\r\n     *   the name.\r\n     * @param {string=} bucket Optional name of the Cloud Storage bucket to apply the rules on. If not specified,\r\n     *   applies the ruleset on the default bucket configured via `AppOptions`.\r\n     * @returns {Promise<void>} A promise that fulfills when the ruleset is released.\r\n     */\r\n    SecurityRules.prototype.releaseStorageRuleset = function (ruleset, bucket) {\r\n        var _this = this;\r\n        return Promise.resolve()\r\n            .then(function () {\r\n            return _this.getBucketName(bucket);\r\n        })\r\n            .then(function (bucketName) {\r\n            return _this.releaseRuleset(ruleset, SecurityRules.FIREBASE_STORAGE + \"/\" + bucketName);\r\n        });\r\n    };\r\n    /**\r\n     * Creates a {@link securityRules.RulesFile `RuleFile`} with the given name\r\n     * and source. Throws an error if any of the arguments are invalid. This is a local\r\n     * operation, and does not involve any network API calls.\r\n     *\r\n     * @example\r\n     * ```javascript\r\n     * const source = '// Some rules source';\r\n     * const rulesFile = admin.securityRules().createRulesFileFromSource(\r\n     *   'firestore.rules', source);\r\n     * ```\r\n     *\r\n     * @param name Name to assign to the rules file. This is usually a short file name that\r\n     *   helps identify the file in a ruleset.\r\n     * @param source Contents of the rules file.\r\n     * @return A new rules file instance.\r\n     */\r\n    SecurityRules.prototype.createRulesFileFromSource = function (name, source) {\r\n        if (!validator.isNonEmptyString(name)) {\r\n            throw new security_rules_internal_1.FirebaseSecurityRulesError('invalid-argument', 'Name must be a non-empty string.');\r\n        }\r\n        var content;\r\n        if (validator.isNonEmptyString(source)) {\r\n            content = source;\r\n        }\r\n        else if (validator.isBuffer(source)) {\r\n            content = source.toString('utf-8');\r\n        }\r\n        else {\r\n            throw new security_rules_internal_1.FirebaseSecurityRulesError('invalid-argument', 'Source must be a non-empty string or a Buffer.');\r\n        }\r\n        return {\r\n            name: name,\r\n            content: content,\r\n        };\r\n    };\r\n    /**\r\n     * Creates a new {@link securityRules.Ruleset `Ruleset`} from the given\r\n     * {@link securityRules.RulesFile `RuleFile`}.\r\n     *\r\n     * @param file Rules file to include in the new `Ruleset`.\r\n     * @returns A promise that fulfills with the newly created `Ruleset`.\r\n     */\r\n    SecurityRules.prototype.createRuleset = function (file) {\r\n        var ruleset = {\r\n            source: {\r\n                files: [file],\r\n            },\r\n        };\r\n        return this.client.createRuleset(ruleset)\r\n            .then(function (rulesetResponse) {\r\n            return new Ruleset(rulesetResponse);\r\n        });\r\n    };\r\n    /**\r\n     * Deletes the {@link securityRules.Ruleset `Ruleset`} identified by the given\r\n     * name. The input name should be the short name string without the project ID\r\n     * prefix. For example, to delete the `projects/project-id/rulesets/my-ruleset`,\r\n     * pass the  short name \"my-ruleset\". Rejects with a `not-found` error if the\r\n     * specified `Ruleset` cannot be found.\r\n     *\r\n     * @param name Name of the `Ruleset` to delete.\r\n     * @return A promise that fulfills when the `Ruleset` is deleted.\r\n     */\r\n    SecurityRules.prototype.deleteRuleset = function (name) {\r\n        return this.client.deleteRuleset(name);\r\n    };\r\n    /**\r\n     * Retrieves a page of ruleset metadata.\r\n     *\r\n     * @param pageSize The page size, 100 if undefined. This is also the maximum allowed\r\n     *   limit.\r\n     * @param nextPageToken The next page token. If not specified, returns rulesets\r\n     *   starting without any offset.\r\n     * @return A promise that fulfills with a page of rulesets.\r\n     */\r\n    SecurityRules.prototype.listRulesetMetadata = function (pageSize, nextPageToken) {\r\n        if (pageSize === void 0) { pageSize = 100; }\r\n        return this.client.listRulesets(pageSize, nextPageToken)\r\n            .then(function (response) {\r\n            return new RulesetMetadataListImpl(response);\r\n        });\r\n    };\r\n    SecurityRules.prototype.getRulesetForRelease = function (releaseName) {\r\n        var _this = this;\r\n        return this.client.getRelease(releaseName)\r\n            .then(function (release) {\r\n            var rulesetName = release.rulesetName;\r\n            if (!validator.isNonEmptyString(rulesetName)) {\r\n                throw new security_rules_internal_1.FirebaseSecurityRulesError('not-found', \"Ruleset name not found for \" + releaseName + \".\");\r\n            }\r\n            return _this.getRuleset(stripProjectIdPrefix(rulesetName));\r\n        });\r\n    };\r\n    SecurityRules.prototype.releaseRuleset = function (ruleset, releaseName) {\r\n        if (!validator.isNonEmptyString(ruleset) &&\r\n            (!validator.isNonNullObject(ruleset) || !validator.isNonEmptyString(ruleset.name))) {\r\n            var err = new security_rules_internal_1.FirebaseSecurityRulesError('invalid-argument', 'ruleset must be a non-empty name or a RulesetMetadata object.');\r\n            return Promise.reject(err);\r\n        }\r\n        var rulesetName = validator.isString(ruleset) ? ruleset : ruleset.name;\r\n        return this.client.updateRelease(releaseName, rulesetName)\r\n            .then(function () {\r\n            return;\r\n        });\r\n    };\r\n    SecurityRules.prototype.getBucketName = function (bucket) {\r\n        var bucketName = (typeof bucket !== 'undefined') ? bucket : this.app.options.storageBucket;\r\n        if (!validator.isNonEmptyString(bucketName)) {\r\n            throw new security_rules_internal_1.FirebaseSecurityRulesError('invalid-argument', 'Bucket name not specified or invalid. Specify a default bucket name via the ' +\r\n                'storageBucket option when initializing the app, or specify the bucket name ' +\r\n                'explicitly when calling the rules API.');\r\n        }\r\n        return bucketName;\r\n    };\r\n    SecurityRules.CLOUD_FIRESTORE = 'cloud.firestore';\r\n    SecurityRules.FIREBASE_STORAGE = 'firebase.storage';\r\n    return SecurityRules;\r\n}());\r\nexports.SecurityRules = SecurityRules;\r\nvar SecurityRulesInternals = /** @class */ (function () {\r\n    function SecurityRulesInternals() {\r\n    }\r\n    SecurityRulesInternals.prototype.delete = function () {\r\n        return Promise.resolve();\r\n    };\r\n    return SecurityRulesInternals;\r\n}());\r\nfunction stripProjectIdPrefix(name) {\r\n    return name.split('/').pop();\r\n}\r\n"]},"metadata":{},"sourceType":"script"}