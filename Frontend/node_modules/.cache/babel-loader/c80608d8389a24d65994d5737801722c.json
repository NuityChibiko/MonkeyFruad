{"ast":null,"code":"/**\r\n * Module dependencies.\r\n */\nvar pause = require('pause'),\n    util = require('util'),\n    Strategy = require('passport-strategy');\n/**\r\n * `SessionStrategy` constructor.\r\n *\r\n * @api public\r\n */\n\n\nfunction SessionStrategy(options, deserializeUser) {\n  if (typeof options == 'function') {\n    deserializeUser = options;\n    options = undefined;\n  }\n\n  options = options || {};\n  Strategy.call(this);\n  this.name = 'session';\n  this._deserializeUser = deserializeUser;\n}\n/**\r\n * Inherit from `Strategy`.\r\n */\n\n\nutil.inherits(SessionStrategy, Strategy);\n/**\r\n * Authenticate request based on the current session state.\r\n *\r\n * The session authentication strategy uses the session to restore any login\r\n * state across requests.  If a login session has been established, `req.user`\r\n * will be populated with the current user.\r\n *\r\n * This strategy is registered automatically by Passport.\r\n *\r\n * @param {Object} req\r\n * @param {Object} options\r\n * @api protected\r\n */\n\nSessionStrategy.prototype.authenticate = function (req, options) {\n  if (!req._passport) {\n    return this.error(new Error('passport.initialize() middleware not in use'));\n  }\n\n  options = options || {};\n  var self = this,\n      su;\n\n  if (req._passport.session) {\n    su = req._passport.session.user;\n  }\n\n  if (su || su === 0) {\n    // NOTE: Stream pausing is desirable in the case where later middleware is\n    //       listening for events emitted from request.  For discussion on the\n    //       matter, refer to: https://github.com/jaredhanson/passport/pull/106\n    var paused = options.pauseStream ? pause(req) : null;\n\n    this._deserializeUser(su, req, function (err, user) {\n      if (err) {\n        return self.error(err);\n      }\n\n      if (!user) {\n        delete req._passport.session.user;\n      } else {\n        // TODO: Remove instance access\n        var property = req._passport.instance._userProperty || 'user';\n        req[property] = user;\n      }\n\n      self.pass();\n\n      if (paused) {\n        paused.resume();\n      }\n    });\n  } else {\n    self.pass();\n  }\n};\n/**\r\n * Expose `SessionStrategy`.\r\n */\n\n\nmodule.exports = SessionStrategy;","map":{"version":3,"sources":["D:/PROJECT ALL/MonkeyFruad/Backend/node_modules/passport/lib/strategies/session.js"],"names":["pause","require","util","Strategy","SessionStrategy","options","deserializeUser","undefined","call","name","_deserializeUser","inherits","prototype","authenticate","req","_passport","error","Error","self","su","session","user","paused","pauseStream","err","property","instance","_userProperty","pass","resume","module","exports"],"mappings":"AAAA;AACA;AACA;AACA,IAAIA,KAAK,GAAGC,OAAO,CAAC,OAAD,CAAnB;AAAA,IACIC,IAAI,GAAGD,OAAO,CAAC,MAAD,CADlB;AAAA,IAEIE,QAAQ,GAAGF,OAAO,CAAC,mBAAD,CAFtB;AAKA;AACA;AACA;AACA;AACA;;;AACA,SAASG,eAAT,CAAyBC,OAAzB,EAAkCC,eAAlC,EAAmD;AACjD,MAAI,OAAOD,OAAP,IAAkB,UAAtB,EAAkC;AAChCC,IAAAA,eAAe,GAAGD,OAAlB;AACAA,IAAAA,OAAO,GAAGE,SAAV;AACD;;AACDF,EAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AAEAF,EAAAA,QAAQ,CAACK,IAAT,CAAc,IAAd;AACA,OAAKC,IAAL,GAAY,SAAZ;AACA,OAAKC,gBAAL,GAAwBJ,eAAxB;AACD;AAED;AACA;AACA;;;AACAJ,IAAI,CAACS,QAAL,CAAcP,eAAd,EAA+BD,QAA/B;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACAC,eAAe,CAACQ,SAAhB,CAA0BC,YAA1B,GAAyC,UAASC,GAAT,EAAcT,OAAd,EAAuB;AAC9D,MAAI,CAACS,GAAG,CAACC,SAAT,EAAoB;AAAE,WAAO,KAAKC,KAAL,CAAW,IAAIC,KAAJ,CAAU,6CAAV,CAAX,CAAP;AAA8E;;AACpGZ,EAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AAEA,MAAIa,IAAI,GAAG,IAAX;AAAA,MACIC,EADJ;;AAEA,MAAIL,GAAG,CAACC,SAAJ,CAAcK,OAAlB,EAA2B;AACzBD,IAAAA,EAAE,GAAGL,GAAG,CAACC,SAAJ,CAAcK,OAAd,CAAsBC,IAA3B;AACD;;AAED,MAAIF,EAAE,IAAIA,EAAE,KAAK,CAAjB,EAAoB;AAClB;AACA;AACA;AAEA,QAAIG,MAAM,GAAGjB,OAAO,CAACkB,WAAR,GAAsBvB,KAAK,CAACc,GAAD,CAA3B,GAAmC,IAAhD;;AACA,SAAKJ,gBAAL,CAAsBS,EAAtB,EAA0BL,GAA1B,EAA+B,UAASU,GAAT,EAAcH,IAAd,EAAoB;AACjD,UAAIG,GAAJ,EAAS;AAAE,eAAON,IAAI,CAACF,KAAL,CAAWQ,GAAX,CAAP;AAAyB;;AACpC,UAAI,CAACH,IAAL,EAAW;AACT,eAAOP,GAAG,CAACC,SAAJ,CAAcK,OAAd,CAAsBC,IAA7B;AACD,OAFD,MAEO;AACL;AACA,YAAII,QAAQ,GAAGX,GAAG,CAACC,SAAJ,CAAcW,QAAd,CAAuBC,aAAvB,IAAwC,MAAvD;AACAb,QAAAA,GAAG,CAACW,QAAD,CAAH,GAAgBJ,IAAhB;AACD;;AACDH,MAAAA,IAAI,CAACU,IAAL;;AACA,UAAIN,MAAJ,EAAY;AACVA,QAAAA,MAAM,CAACO,MAAP;AACD;AACF,KAbD;AAcD,GApBD,MAoBO;AACLX,IAAAA,IAAI,CAACU,IAAL;AACD;AACF,CAjCD;AAoCA;AACA;AACA;;;AACAE,MAAM,CAACC,OAAP,GAAiB3B,eAAjB","sourcesContent":["/**\r\n * Module dependencies.\r\n */\r\nvar pause = require('pause')\r\n  , util = require('util')\r\n  , Strategy = require('passport-strategy');\r\n\r\n\r\n/**\r\n * `SessionStrategy` constructor.\r\n *\r\n * @api public\r\n */\r\nfunction SessionStrategy(options, deserializeUser) {\r\n  if (typeof options == 'function') {\r\n    deserializeUser = options;\r\n    options = undefined;\r\n  }\r\n  options = options || {};\r\n  \r\n  Strategy.call(this);\r\n  this.name = 'session';\r\n  this._deserializeUser = deserializeUser;\r\n}\r\n\r\n/**\r\n * Inherit from `Strategy`.\r\n */\r\nutil.inherits(SessionStrategy, Strategy);\r\n\r\n/**\r\n * Authenticate request based on the current session state.\r\n *\r\n * The session authentication strategy uses the session to restore any login\r\n * state across requests.  If a login session has been established, `req.user`\r\n * will be populated with the current user.\r\n *\r\n * This strategy is registered automatically by Passport.\r\n *\r\n * @param {Object} req\r\n * @param {Object} options\r\n * @api protected\r\n */\r\nSessionStrategy.prototype.authenticate = function(req, options) {\r\n  if (!req._passport) { return this.error(new Error('passport.initialize() middleware not in use')); }\r\n  options = options || {};\r\n\r\n  var self = this, \r\n      su;\r\n  if (req._passport.session) {\r\n    su = req._passport.session.user;\r\n  }\r\n\r\n  if (su || su === 0) {\r\n    // NOTE: Stream pausing is desirable in the case where later middleware is\r\n    //       listening for events emitted from request.  For discussion on the\r\n    //       matter, refer to: https://github.com/jaredhanson/passport/pull/106\r\n    \r\n    var paused = options.pauseStream ? pause(req) : null;\r\n    this._deserializeUser(su, req, function(err, user) {\r\n      if (err) { return self.error(err); }\r\n      if (!user) {\r\n        delete req._passport.session.user;\r\n      } else {\r\n        // TODO: Remove instance access\r\n        var property = req._passport.instance._userProperty || 'user';\r\n        req[property] = user;\r\n      }\r\n      self.pass();\r\n      if (paused) {\r\n        paused.resume();\r\n      }\r\n    });\r\n  } else {\r\n    self.pass();\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Expose `SessionStrategy`.\r\n */\r\nmodule.exports = SessionStrategy;\r\n"]},"metadata":{},"sourceType":"script"}