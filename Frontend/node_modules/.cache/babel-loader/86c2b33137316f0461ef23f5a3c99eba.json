{"ast":null,"code":"/**\r\n * Assign a value to a nested object\r\n * @function putNestedValue\r\n * @param params the parent object - this argument will be modified!\r\n * @param key key in the form nested[innerkey]\r\n * @param value the value to assign\r\n * @return the modified params object\r\n */\nconst url = require('url');\n\nconst extend = require(\"lodash/extend\");\n\nconst isObject = require(\"lodash/isObject\");\n\nconst isString = require(\"lodash/isString\");\n\nconst isUndefined = require(\"lodash/isUndefined\");\n\nconst entries = require('./utils/entries');\n\nlet cloudinary_config = void 0;\n/**\r\n * Sets a value in an object using a nested key\r\n * @param {object} params The object to assign the value in.\r\n * @param {string} key The key of the value. A period is used to denote inner keys.\r\n * @param {*} value The value to set.\r\n * @returns {object} The params argument.\r\n * @example\r\n *     let o = {foo: {bar: 1}};\r\n *     putNestedValue(o, 'foo.bar', 2); // {foo: {bar: 2}}\r\n *     putNestedValue(o, 'foo.inner.key', 'this creates an inner object');\r\n *     // {{foo: {bar: 2}, inner: {key: 'this creates an inner object'}}}\r\n */\n\nfunction putNestedValue(params, key, value) {\n  let chain = key.split(/[\\[\\]]+/).filter(i => i.length);\n  let outer = params;\n  let lastKey = chain.pop();\n\n  for (let j = 0; j < chain.length; j++) {\n    let innerKey = chain[j];\n    let inner = outer[innerKey];\n\n    if (inner == null) {\n      inner = {};\n      outer[innerKey] = inner;\n    }\n\n    outer = inner;\n  }\n\n  outer[lastKey] = value;\n  return params;\n}\n\nfunction parseCloudinaryConfigFromEnvURL(ENV_STR) {\n  let conf = {};\n  let uri = url.parse(ENV_STR, true);\n\n  if (uri.protocol === 'cloudinary:') {\n    conf = Object.assign({}, conf, {\n      cloud_name: uri.host,\n      api_key: uri.auth && uri.auth.split(\":\")[0],\n      api_secret: uri.auth && uri.auth.split(\":\")[1],\n      private_cdn: uri.pathname != null,\n      secure_distribution: uri.pathname && uri.pathname.substring(1)\n    });\n  } else if (uri.protocol === 'account:') {\n    conf = Object.assign({}, conf, {\n      account_id: uri.host,\n      provisioning_api_key: uri.auth && uri.auth.split(\":\")[0],\n      provisioning_api_secret: uri.auth && uri.auth.split(\":\")[1]\n    });\n  }\n\n  return conf;\n}\n\nfunction extendCloudinaryConfigFromQuery(ENV_URL, confToExtend = {}) {\n  let uri = url.parse(ENV_URL, true);\n\n  if (uri.query != null) {\n    entries(uri.query).forEach(([key, value]) => putNestedValue(confToExtend, key, value));\n  }\n}\n\nfunction extendCloudinaryConfig(parsedConfig, confToExtend = {}) {\n  entries(parsedConfig).forEach(([key, value]) => {\n    if (value !== undefined) {\n      confToExtend[key] = value;\n    }\n  });\n  return confToExtend;\n}\n\nmodule.exports = function (new_config, new_value) {\n  if (cloudinary_config == null || new_config === true) {\n    if (cloudinary_config == null) {\n      cloudinary_config = {};\n    } else {\n      Object.keys(cloudinary_config).forEach(key => delete cloudinary_config[key]);\n    }\n\n    let CLOUDINARY_ENV_URL = process.env.CLOUDINARY_URL;\n    let CLOUDINARY_ENV_ACCOUNT_URL = process.env.CLOUDINARY_ACCOUNT_URL;\n\n    if (CLOUDINARY_ENV_URL && !CLOUDINARY_ENV_URL.toLowerCase().startsWith('cloudinary://')) {\n      throw new Error(\"Invalid CLOUDINARY_URL protocol. URL should begin with 'cloudinary://'\");\n    }\n\n    if (CLOUDINARY_ENV_ACCOUNT_URL && !CLOUDINARY_ENV_ACCOUNT_URL.toLowerCase().startsWith('account://')) {\n      throw new Error(\"Invalid CLOUDINARY_ACCOUNT_URL protocol. URL should begin with 'account://'\");\n    }\n\n    [CLOUDINARY_ENV_URL, CLOUDINARY_ENV_ACCOUNT_URL].forEach(ENV_URL => {\n      if (ENV_URL) {\n        let parsedConfig = parseCloudinaryConfigFromEnvURL(ENV_URL);\n        extendCloudinaryConfig(parsedConfig, cloudinary_config); // Provide Query support in ENV url cloudinary://key:secret@test123?foo[bar]=value\n        // expect(cloudinary_config.foo.bar).to.eql('value')\n\n        extendCloudinaryConfigFromQuery(ENV_URL, cloudinary_config);\n      }\n    });\n  }\n\n  if (!isUndefined(new_value)) {\n    cloudinary_config[new_config] = new_value;\n  } else if (isString(new_config)) {\n    return cloudinary_config[new_config];\n  } else if (isObject(new_config)) {\n    extend(cloudinary_config, new_config);\n  }\n\n  return cloudinary_config;\n};","map":{"version":3,"sources":["D:/PROJECT ALL/MonkeyFruad/Backend/node_modules/cloudinary/lib/config.js"],"names":["url","require","extend","isObject","isString","isUndefined","entries","cloudinary_config","putNestedValue","params","key","value","chain","split","filter","i","length","outer","lastKey","pop","j","innerKey","inner","parseCloudinaryConfigFromEnvURL","ENV_STR","conf","uri","parse","protocol","Object","assign","cloud_name","host","api_key","auth","api_secret","private_cdn","pathname","secure_distribution","substring","account_id","provisioning_api_key","provisioning_api_secret","extendCloudinaryConfigFromQuery","ENV_URL","confToExtend","query","forEach","extendCloudinaryConfig","parsedConfig","undefined","module","exports","new_config","new_value","keys","CLOUDINARY_ENV_URL","process","env","CLOUDINARY_URL","CLOUDINARY_ENV_ACCOUNT_URL","CLOUDINARY_ACCOUNT_URL","toLowerCase","startsWith","Error"],"mappings":"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","sourcesContent":["/**\r\n * Assign a value to a nested object\r\n * @function putNestedValue\r\n * @param params the parent object - this argument will be modified!\r\n * @param key key in the form nested[innerkey]\r\n * @param value the value to assign\r\n * @return the modified params object\r\n */\r\nconst url = require('url');\r\nconst extend = require(\"lodash/extend\");\r\nconst isObject = require(\"lodash/isObject\");\r\nconst isString = require(\"lodash/isString\");\r\nconst isUndefined = require(\"lodash/isUndefined\");\r\nconst entries = require('./utils/entries');\r\n\r\nlet cloudinary_config = void 0;\r\n\r\n/**\r\n * Sets a value in an object using a nested key\r\n * @param {object} params The object to assign the value in.\r\n * @param {string} key The key of the value. A period is used to denote inner keys.\r\n * @param {*} value The value to set.\r\n * @returns {object} The params argument.\r\n * @example\r\n *     let o = {foo: {bar: 1}};\r\n *     putNestedValue(o, 'foo.bar', 2); // {foo: {bar: 2}}\r\n *     putNestedValue(o, 'foo.inner.key', 'this creates an inner object');\r\n *     // {{foo: {bar: 2}, inner: {key: 'this creates an inner object'}}}\r\n */\r\nfunction putNestedValue(params, key, value) {\r\n  let chain = key.split(/[\\[\\]]+/).filter(i => i.length);\r\n  let outer = params;\r\n  let lastKey = chain.pop();\r\n  for (let j = 0; j < chain.length; j++) {\r\n    let innerKey = chain[j];\r\n    let inner = outer[innerKey];\r\n    if (inner == null) {\r\n      inner = {};\r\n      outer[innerKey] = inner;\r\n    }\r\n    outer = inner;\r\n  }\r\n  outer[lastKey] = value;\r\n  return params;\r\n}\r\n\r\nfunction parseCloudinaryConfigFromEnvURL(ENV_STR) {\r\n  let conf = {};\r\n\r\n  let uri = url.parse(ENV_STR, true);\r\n\r\n  if (uri.protocol === 'cloudinary:') {\r\n    conf = Object.assign({}, conf, {\r\n      cloud_name: uri.host,\r\n      api_key: uri.auth && uri.auth.split(\":\")[0],\r\n      api_secret: uri.auth && uri.auth.split(\":\")[1],\r\n      private_cdn: uri.pathname != null,\r\n      secure_distribution: uri.pathname && uri.pathname.substring(1)\r\n    });\r\n  } else if (uri.protocol === 'account:') {\r\n    conf = Object.assign({}, conf, {\r\n      account_id: uri.host,\r\n      provisioning_api_key: uri.auth && uri.auth.split(\":\")[0],\r\n      provisioning_api_secret: uri.auth && uri.auth.split(\":\")[1]\r\n    });\r\n  }\r\n\r\n  return conf;\r\n}\r\n\r\nfunction extendCloudinaryConfigFromQuery(ENV_URL, confToExtend = {}) {\r\n  let uri = url.parse(ENV_URL, true);\r\n  if (uri.query != null) {\r\n    entries(uri.query).forEach(([key, value]) => putNestedValue(confToExtend, key, value));\r\n  }\r\n}\r\n\r\nfunction extendCloudinaryConfig(parsedConfig, confToExtend = {}) {\r\n  entries(parsedConfig).forEach(([key, value]) => {\r\n    if (value !== undefined) {\r\n      confToExtend[key] = value;\r\n    }\r\n  });\r\n\r\n  return confToExtend;\r\n}\r\n\r\nmodule.exports = function (new_config, new_value) {\r\n  if ((cloudinary_config == null) || new_config === true) {\r\n    if (cloudinary_config == null) {\r\n      cloudinary_config = {};\r\n    } else {\r\n      Object.keys(cloudinary_config).forEach(key => delete cloudinary_config[key]);\r\n    }\r\n\r\n    let CLOUDINARY_ENV_URL = process.env.CLOUDINARY_URL;\r\n    let CLOUDINARY_ENV_ACCOUNT_URL = process.env.CLOUDINARY_ACCOUNT_URL;\r\n    \r\n    if (CLOUDINARY_ENV_URL && !CLOUDINARY_ENV_URL.toLowerCase().startsWith('cloudinary://')) {\r\n      throw new Error(\"Invalid CLOUDINARY_URL protocol. URL should begin with 'cloudinary://'\");\r\n    }\r\n    if (CLOUDINARY_ENV_ACCOUNT_URL && !CLOUDINARY_ENV_ACCOUNT_URL.toLowerCase().startsWith('account://')) {\r\n      throw new Error(\"Invalid CLOUDINARY_ACCOUNT_URL protocol. URL should begin with 'account://'\");\r\n    }\r\n\r\n    [CLOUDINARY_ENV_URL, CLOUDINARY_ENV_ACCOUNT_URL].forEach((ENV_URL) => {\r\n      if (ENV_URL) {\r\n        let parsedConfig = parseCloudinaryConfigFromEnvURL(ENV_URL);\r\n        extendCloudinaryConfig(parsedConfig, cloudinary_config);\r\n        // Provide Query support in ENV url cloudinary://key:secret@test123?foo[bar]=value\r\n        // expect(cloudinary_config.foo.bar).to.eql('value')\r\n        extendCloudinaryConfigFromQuery(ENV_URL, cloudinary_config);\r\n      }\r\n    });\r\n  }\r\n  if (!isUndefined(new_value)) {\r\n    cloudinary_config[new_config] = new_value;\r\n  } else if (isString(new_config)) {\r\n    return cloudinary_config[new_config];\r\n  } else if (isObject(new_config)) {\r\n    extend(cloudinary_config, new_config);\r\n  }\r\n  return cloudinary_config;\r\n};\r\n"]},"metadata":{},"sourceType":"script"}